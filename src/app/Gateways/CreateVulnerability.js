import { hackneyToken } from '../lib/Cookie';

export default async ({ customerId }) => {
  const response = await fetch(
    `${process.env.REACT_APP_HN_API_URL}/customers/${customerId}/vulnerabilities`,
    {
      method: 'POST',
      headers: {
        Authorization: `Bearer ${hackneyToken()}`
      }
    }
  );

  if (response.ok) {
    const { snapshotId } = await response.json();

    return {
      location: `${process.env.REACT_APP_VULNERABILITIES_URL}/snapshots/${snapshotId}`
    };
  }

  throw new Error(
    `Failed to create vulnerability snapshot, status: ${response.status}`
  );
};
